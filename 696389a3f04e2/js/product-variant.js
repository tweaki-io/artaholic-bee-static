class VariantSelects extends HTMLElement{constructor(){super(),this.addEventListener("change",this.onVariantChange)}onVariantChange(){this.updateOptions(),this.updateOptionsParent(),this.updateMasterId(),this.toggleAddButton(!0,"",!1),this.getPreOrderVariantData(),this.updatePickupAvailability(),this.updateContent(),this.updateVariantStatuses(),this.currentVariant?(this.updateMedia(),this.updateURL(),this.updateVariantInput(),this.renderProductInfo()):(this.toggleAddButton(!0,"",!0),this.setUnavailable())}updateOptions(){this.options=Array.from(this.querySelectorAll("select"),select=>select.value)}updateOptionsParent(){Array.from(this.querySelectorAll(".product-form__input--dropdown")).map((select,index)=>{select.children[0].children[1].innerHTML=this.options[index]})}updateMasterId(){this.currentVariant=this.getVariantData().find(variant=>!variant.options.map((option,index)=>this.options[index]===option).includes(!1))}updateMedia(){if(!this.currentVariant||!this.currentVariant.featured_media)return;document.getElementById(`MediaGallery-${this.dataset.section}`).setActiveMedia(`${this.dataset.section}-${this.currentVariant.featured_media.id}`,!0)}updateContent(){let variant=this.currentVariant,variandID=this.currentVariant?.id??null,notifyMeAvailableWrapperList=document.querySelectorAll(`.notify__me--available-${this.dataset.section}`);notifyMeAvailableWrapperList.length>0&&notifyMeAvailableWrapperList.forEach(notifyMeAvailableWrapper=>{if(variandID!=null&&!variant.available){let soldOurtProductURL=document.querySelector(".soldout__product_url");soldOurtProductURL.value=`${this.dataset.origin}${this.dataset.url}?variant=${this.currentVariant.id}`,notifyMeAvailableWrapper&&notifyMeAvailableWrapper.classList.remove("no-js-inline")}else notifyMeAvailableWrapper&&notifyMeAvailableWrapper.classList.add("no-js-inline")})}updateURL(){!this.currentVariant||this.dataset.updateUrl==="false"||window.history.replaceState({},"",`${this.dataset.url}?variant=${this.currentVariant.id}`)}updateVariantInput(){document.querySelectorAll(`#product-form-${this.dataset.section}, #product-form-installment`).forEach(productForm=>{const input=productForm.querySelector('input[name="id"]');input.value=this.currentVariant.id,input.dispatchEvent(new Event("change",{bubbles:!0}))})}updateVariantStatuses(){const selectedOptionOneVariants=this.variantData.filter(variant=>this.querySelector(":checked").value===variant.option1),inputWrappers=[...this.querySelectorAll(".product-form__input")];inputWrappers.forEach((option,index)=>{if(index===0)return;const optionInputs=[...option.querySelectorAll('input[type="radio"], option')],previousOptionSelected=inputWrappers[index-1].querySelector(":checked").value,availableOptionInputsValue=selectedOptionOneVariants.filter(variant=>variant.available&&variant[`option${index}`]===previousOptionSelected).map(variantOption=>variantOption[`option${index+1}`]);this.setInputAvailability(optionInputs,availableOptionInputsValue)})}setInputAvailability(listOfOptions,listOfAvailableOptions){listOfOptions.forEach(input=>{listOfAvailableOptions.includes(input.getAttribute("value"))?input.innerText=input.getAttribute("value"):input.innerText=window.variantStrings.unavailable_with_option.replace("[value]",input.getAttribute("value"))})}updatePickupAvailability(){const pickUpAvailability=document.querySelector("pickup-availability");pickUpAvailability&&(this.currentVariant&&this.currentVariant.available?pickUpAvailability.fetchAvailability(this.currentVariant.id):(pickUpAvailability.removeAttribute("available"),pickUpAvailability.innerHTML=""))}renderProductInfo(){fetch(`${this.dataset.url}?variant=${this.currentVariant.id}&section_id=${this.dataset.section}`).then(response=>response.text()).then(responseText=>{let id=`price-${this.dataset.section}`,stockInventory=`inventory__stock--${this.dataset.section}`,barcodeId=`barcode__${this.dataset.section}`,skuId=`sku__${this.dataset.section}`;const html=new DOMParser().parseFromString(responseText,"text/html");let destination=document.getElementById(id),stockInventoryDestination=document.getElementById(stockInventory),barcodeDestination=document.getElementById(barcodeId),skuDestination=document.getElementById(skuId),source=html.getElementById(id),stockInventorySource=html.getElementById(stockInventory),barcodeSource=html.getElementById(barcodeId),skuSource=html.getElementById(skuId);source&&destination&&(destination.innerHTML=source.innerHTML),stockInventorySource&&stockInventoryDestination&&(stockInventoryDestination.innerHTML=stockInventorySource.innerHTML),barcodeSource&&barcodeDestination&&(barcodeDestination.innerHTML=barcodeSource.innerHTML),skuSource&&skuDestination&&(skuDestination.innerHTML=skuSource.innerHTML);const price=document.getElementById(`price-${this.dataset.section}`);price&&price.classList.remove("no-js-inline"),this.toggleAddButton(!this.currentVariant.available,window.variantStrings.soldOut)})}toggleAddButton(disable=!0,text,modifyClass=!0){const productForm=document.getElementById(`product-form-${this.dataset.section}`);if(!productForm)return;const addButton=productForm.querySelector('[name="add"]'),addButtonText=addButton.querySelector(".cart--button-text");if(addButton&&(disable?(addButton.setAttribute("disabled",!0),text&&(addButtonText.textContent=text)):(addButton.removeAttribute("disabled"),addButtonText.innerHTML=`${window.variantStrings.addToCart}`),window.preorder_button)){let productVarArray=this.PreorderVariantData,variant=this.currentVariant,VarInventoryManagement=this.currentVariant?.inventory_management??null,var_num="";if(VarInventoryManagement!=null)for(let variant_id in productVarArray){if(variant.id==variant_id){var_num=productVarArray[variant_id].qty;var inventoryQuantity=parseInt(var_num),inventoryPolicy=productVarArray[variant_id].inventory_policy}inventoryQuantity<=0&&inventoryPolicy==="continue"?(addButton.removeAttribute("disabled"),addButtonText.innerHTML=`${window.variantStrings.preorder}`):inventoryQuantity<=0&&inventoryPolicy!=="continue"?(addButton.setAttribute("disabled",!0),addButtonText.textContent=window.variantStrings.soldOut):(addButton.removeAttribute("disabled"),addButtonText.innerHTML=`${window.variantStrings.addToCart}`)}}}setUnavailable(){const addButton=document.getElementById(`product-form-${this.dataset.section}`).querySelector('[name="add"]'),price=document.getElementById(`price-${this.dataset.section}`);addButton&&(addButton.textContent=window.variantStrings.unavailable,price&&price.classList.add("no-js-inline"))}getVariantData(){return this.variantData=this.variantData||JSON.parse(this.querySelector("[data-variant]").textContent),this.variantData}getPreOrderVariantData(){this.PreorderVariantData=this.PreorderVariantData||JSON.parse(this.querySelector("[data-preorder]").textContent)}}customElements.define("variant-selects",VariantSelects);class VariantRadios extends VariantSelects{constructor(){super(),this.fieldsets=Array.from(this.querySelectorAll("fieldset")),this.onColorSwatches()}onColorSwatches(){const variantList=this.getVariantData()||[],swatchButtonList=this.querySelectorAll(`fieldset.variant--swatch-${this.dataset.colorSwatch} > label`),result=Object.values(variantList.reduce((total,item)=>{let k=`${item[this.dataset.colorSwatch]}`;return total[k]?total[k].count+=1:total[k]={...item,count:1},total},{}));swatchButtonList.length>0&&swatchButtonList.forEach(button=>{result.forEach(data=>{data[this.dataset.colorSwatch]===button.dataset.value&&(this.dataset.colorSwatchStyle==="image"&&data.featured_image!==null?button.setAttribute("style",`--swatch-background-image: url(${data.featured_image.src}); --swatch-background-color: ${data[this.dataset.colorSwatch]};`):button.setAttribute("style",`--swatch-background-color: ${data[this.dataset.colorSwatch]};`))})})}setInputAvailability(listOfOptions,listOfAvailableOptions){listOfOptions.forEach(input=>{listOfAvailableOptions.includes(input.getAttribute("value"))?input.classList.remove("disabled"):input.classList.add("disabled")})}updateOptions(){const fieldsets=Array.from(this.querySelectorAll("fieldset"));this.options=fieldsets.map(fieldset=>Array.from(fieldset.querySelectorAll("input")).find(radio=>radio.checked).value)}updateOptionsParent(){this.fieldsets.map((fieldset,index)=>{fieldset.children[0].children[1].innerHTML=this.options[index]})}}customElements.define("variant-radios",VariantRadios);
//# sourceMappingURL=/cdn/shop/t/4/assets/product-variant.js.map?v=50531060620034172511710100718
